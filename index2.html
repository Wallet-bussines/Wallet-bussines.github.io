<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minería de Verus Coin</title>
    <style>
        body {
            background-color: #0d0d0d;
            color: #39ff14; /* Color verde neón */
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        p {
            font-size: 1.2em;
            margin: 5px 0;
        }
        button {
            background-color: #39ff14;
            color: black;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #28a745;
        }
        #status {
            margin-top: 20px;
            font-size: 1.1em;
        }
        #stats {
            margin-top: 10px;
            font-size: 1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Minería de Verus Coin (VRSC)</h1>
        <p>Dirección de Wallet: <strong>RPqwP8wuRWFGiP31f7NTDq6KgF6B5Crych</strong></p>
        <p>Pool: <strong>pool.verus.io:9998</strong></p>
        
        <button id="startMining">Iniciar Minería</button>
        <div id="status"></div>
        <div id="stats"></div>
    </div>

    <script>
        let mining = false;
        let nonce = 0;
        let minerInterval;
        let jobId;
        let prevHash;
        let coinbase1;
        let coinbase2;
        let merkleBranch;

        const walletAddress = 'RPqwP8wuRWFGiP31f7NTDq6KgF6B5Crych.x';
        const poolUrl = 'http://45.33.47.25:3000/api/poolData/72/6596237097b04b05eb151553/67028dbd5f09df3d488db72e/settings';

        document.getElementById('startMining').onclick = function() {
            if (!mining) {
                startMining();
            } else {
                stopMining();
            }
        };

        function startMining() {
            mining = true;
            nonce = 0;
            document.getElementById('status').innerHTML = 'Minería iniciada...<br>Enviando nonces válidos...';
            
            minerInterval = setInterval(() => {
                if (jobId) {
                    const validNonce = generateValidNonce(nonce);
                    sendNonceToPool(validNonce);
                    nonce++;
                }
            }, 1000); // Enviar un nonce cada segundo

            simulateMiningStats();
        }

        function stopMining() {
            mining = false;
            clearInterval(minerInterval);
            document.getElementById('status').innerHTML = 'Minería detenida.';
            document.getElementById('stats').innerHTML = ''; // Limpiar estadísticas al detener
        }

        function generateValidNonce(currentNonce) {
            return currentNonce.toString(16).padStart(64, '0'); // Convierte a hexadecimal
        }

        function sendNonceToPool(nonce) {
            const coinbase = coinbase1 + generateExtraNonce(nonce) + coinbase2; // Combina las partes de coinbase
            const payload = {
                id: 1,
                method: "mining.submit",
                params: [walletAddress + '.x', jobId, prevHash, nonce, coinbase]
            };

            fetch(poolUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer BB75AA0EB639D0F79E8A1E3AD54BAAE1',
                },
                body: JSON.stringify(payload),
            })
            .then(response => response.json())
            .then(data => {
                if (data.result) {
                    console.log('Nonce enviado: ' + nonce);
                } else {
                    console.error('Error al enviar nonce: ', data.error);
                }
            })
            .catch(error => console.error('Error de conexión:', error));
        }

        function generateExtraNonce(nonce) {
            return nonce.toString(16).padStart(8, '0'); // Genera un nonce extra en hexadecimal
        }

        function simulateMiningStats() {
            const statsDiv = document.getElementById('stats');
            setInterval(() => {
                if (mining) {
                    const hashRate = (Math.random() * (50 - 30) + 30).toFixed(2) + ' H/s'; // Simulación de hash rate
                    const poolBalance = (Math.random() * (0.02 - 0.005) + 0.005).toFixed(8) + ' VRSC'; // Simulación de saldo en pool

                    statsDiv.innerHTML = `<strong>Hash Rate:</strong> ${hashRate}<br><strong>Saldo del Pool:</strong> ${poolBalance}`;
                }
            }, 5000); // Actualiza cada 5 segundos
        }

        // Función para recibir la notificación de minería
        function handleMiningNotify(params) {
            jobId = params[0]; // Asigna el Job ID
            prevHash = params[2]; // Hash del bloque anterior
            coinbase1 = params[3]; // Parte 1 de la transacción de coinbase
            coinbase2 = params[4]; // Parte 2 de la transacción de coinbase
            merkleBranch = params[5]; // Rama de Merkle

            console.log(`Nueva notificación de minería: ${jobId}`);
        }

        // Ejemplo de cómo recibir la notificación (a través de WebSocket o HTTP)
        function listenForMiningNotifications() {
            // Aquí debes implementar la lógica para escuchar las notificaciones del pool
            // Esto es solo un ejemplo. Deberías conectarte al servidor de WebSocket o HTTP de tu pool.
            // Suponiendo que tienes un WebSocket para recibir las notificaciones:
            const socket = new WebSocket('ws://tu-pool-url'); // Reemplaza con la URL real de tu pool

            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.method === "mining.notify") {
                    handleMiningNotify(data.params);
                }
            };

            socket.onerror = function(error) {
                console.error('Error en WebSocket:', error);
            };
        }

        // Llama a la función para escuchar notificaciones
        listenForMiningNotifications();
    </script>
</body>
</html>
