<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Simulador de Minería Verus Hash</title>
    <style>
        body {
            background-color: #1e1e1e;
            color: #00ff00;
            font-family: monospace;
        }
        .console {
            white-space: pre-wrap;
            padding: 10px;
            border: 1px solid #444;
            background: #111;
            overflow-y: scroll;
            height: 80vh;
        }
    </style>
</head>
<body>
    <h1>Simulador de Minería Verus Hash</h1>
    <div id="console" class="console"></div>

    <script>
        const poolUrl = "http://45.33.47.25:3000/api/poolData/72/6596237097b04b05eb151553/67028dbd5f09df3d488db72e/workers";
        const authToken = "4F4A82926776F06FA7F70010C94C7C95"; // Cambia esto por tu autenticación real
        const workerName = "noname"; // Nombre del trabajador
        let invalidNonces = 0; // Contador de nonces inválidos
        let difficulty = 50000; // Dificultad inicial

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest("SHA-256", msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function startMining() {
            const consoleOutput = document.getElementById("console");
            const threads = 64; // Número máximo de hilos

            // Registra al trabajador en el pool
            const workerResponse = await registerWorker(workerName);
            consoleOutput.innerText += `Registro de trabajador: ${workerResponse.status === 0 ? 'Éxito' : 'Fallo'}\n`;

            for (let i = 0; i < threads; i++) {
                mineOnThread(i);
            }

            async function registerWorker(workerName) {
                const response = await fetch(poolUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "auth": authToken
                    },
                    body: JSON.stringify({ poolSubItem: "0" }) // Ajustar según sea necesario
                });
                return response.json();
            }

            async function mineOnThread(threadId) {
                let nonce = 0;

                while (true) {
                    const message = `VerusHashSimulationThread${threadId}_Nonce${nonce}`;
                    const hash = await sha256(message);
                    const hashRate = (200 + Math.random() * 300).toFixed(2); // Simulación de tasa de hash en kH/s

                    // Simula la aceptación de un hash
                    if (Math.random() > 0.5) { // 50% de probabilidad de aceptación
                        const acceptedMessage = `[${new Date().toLocaleTimeString()}] CPU T${threadId}: Verus Hashing. (${hash}), ${(hashRate / 1000).toFixed(2)} MH/s\n`;
                        consoleOutput.innerText += acceptedMessage;
                        sendHashToPool(hash, threadId);
                    } else {
                        invalidNonces++; // Incrementar contador de nonces inválidos
                        consoleOutput.innerText += `[${new Date().toLocaleTimeString()}] CPU T${threadId}: Nonce inválido ${nonce}\n`;
                    }

                    nonce++;

                    // Ajustar dificultad cada 100 nonces
                    if (nonce % 100 === 0) {
                        adjustDifficulty();
                    }

                    // Breve pausa para liberar recursos
                    await new Promise(resolve => setTimeout(resolve, 10)); // Ajustar tiempo según necesidad
                }
            }

            async function sendHashToPool(hash, threadId) {
                // Lógica para enviar el hash aceptado al pool
                const response = await fetch(poolUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "auth": authToken
                    },
                    body: JSON.stringify({ hash, threadId }) // Ajustar según la API del pool
                });

                const result = await response.json();
                consoleOutput.innerText += `[${new Date().toLocaleTimeString()}] Hash enviado: ${result.description}\n`;
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }

            function adjustDifficulty() {
                // Lógica para ajustar la dificultad en función de los nonces inválidos
                if (invalidNonces > 10) {
                    difficulty += 1000; // Aumentar dificultad si hay muchos nonces inválidos
                    invalidNonces = 0; // Reiniciar contador de nonces inválidos
                    consoleOutput.innerText += `[${new Date().toLocaleTimeString()}] Dificultad aumentada a ${difficulty}\n`;
                } else if (invalidNonces < 5) {
                    difficulty = Math.max(1000, difficulty - 1000); // Reducir dificultad, sin caer por debajo de 1000
                    consoleOutput.innerText += `[${new Date().toLocaleTimeString()}] Dificultad reducida a ${difficulty}\n`;
                }
            }
        }

        // Inicia la minería automáticamente
        startMining();
    </script>
</body>
</html>
