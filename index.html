<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Pago Empresarial</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-qrcode/1.0/jquery.qrcode.min.js"></script>
    <style>
        /* Estilos del formulario */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
        }
        .form-container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #0056b3;
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 12px;
            background-color: #0056b3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #004494;
        }
        .token-table {
            margin-top: 20px;
            width: 100%;
            border-collapse: collapse;
        }
        .token-table th, .token-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ccc;
        }
        .token-table th {
            background-color: #0056b3;
            color: white;
        }
        .output-value {
            font-weight: bold;
            color: #0056b3;
        }
    </style>
</head>
<body>

<div class="form-container">
    <h2>Formulario de Pago Empresarial</h2>
    <form>
        <label for="nombre">Nombre y apellidos:</label>
        <input type="text" id="nombre" placeholder="Ingresa tu nombre">
        
        <label for="documento">Documento identidad:</label>
        <input type="text" id="documento" placeholder="Ingresa tu documento">
        
        <label for="cuenta">Número de Cuenta nequi:</label>
        <input type="text" id="cuenta" placeholder="Ingresa tu cuenta">
        
        <label for="wallet">Tu Wallet aqui:</label>
        <input type="text" id="wallet" placeholder="Ingresa la wallet del cliente">
        
        <label for="token">Selecciona el Token:</label>
        <select id="token">
            <option value="WLD">Wordcoin (WLD)</option>
            <option value="ORB">ORB</option>
            <option value="ORO">ORO</option>
            <option value="USDT">USDT</option>
            <option value="ETH">ETH</option>
            <option value="BTC">BTC</option>
        </select>
        
        <label for="cantidad">Cantidad:</label>
        <input type="number" id="cantidad" placeholder="Cantidad a enviar">
        
        <label>Precio del Token:</label>
        <p id="precio-token" class="output-value">Cargando...</p>
        
        <label>Valor a Recibir:</label>
        <p id="valor-recibir" class="output-value">0 COP</p>
        
        <label for="url-bloque">URL del Bloque:</label>
        <input type="text" id="url-bloque" placeholder="Ingresa la URL del bloque">
        
        <label for="id-transferencia">Identificador de Transferencia:</label>
        <input type="text" id="id-transferencia" readonly placeholder="Generar identificador">
        
        <button type="button" onclick="generarQRCode()">Generar QR Code</button>
        <button type="button" onclick="enviarWhatsApp()">Enviar WhatsApp</button>
    </form>

    <!-- Tabla de tokens disponibles -->
    <h2>Tokens Disponibles</h2>
    <table class="token-table">
        <thead>
            <tr>
                <th>Token</th>
                <th>Precio (COP)</th>
                <th>Acción</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>WLD</td>
                <td id="precio-wld">Cargando...</td>
                <td><button onclick="venderToken('WLD')">Vender</button></td>
            </tr>
            <tr>
                <td>ORB</td>
                <td id="precio-orb">Cargando...</td>
                <td><button onclick="venderToken('ORB')">Vender</button></td>
            </tr>
            <tr>
                <td>ORO</td>
                <td id="precio-oro">Cargando...</td>
                <td><button onclick="venderToken('ORO')">Vender</button></td>
            </tr>
            <tr>
                <td>USDT</td>
                <td id="precio-usdt">Cargando...</td>
                <td><button onclick="venderToken('USDT')">Vender</button></td>
            </tr>
            <tr>
                <td>ETH</td>
                <td id="precio-eth">Cargando...</td>
                <td><button onclick="venderToken('ETH')">Vender</button></td>
            </tr>
            <tr>
                <td>BTC</td>
                <td id="precio-btc">Cargando...</td>
                <td><button onclick="venderToken('BTC')">Vender</button></td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    const preciosTokens = {};
    const tasaCambio = 4407; // Tipo de cambio ajustable

    function obtenerPrecioToken(token) {
        fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${token}USDT`)
            .then(response => response.json())
            .then(data => {
                const precioUSD = parseFloat(data.price);
                const precioCOP = precioUSD * tasaCambio;
                preciosTokens[token] = precioCOP;

                document.getElementById(`precio-${token.toLowerCase()}`).textContent = precioCOP.toLocaleString('es-CO', { minimumFractionDigits: 2 }) + ' COP';
                if (token === document.getElementById("token").value) {
                    document.getElementById("precio-token").textContent = precioCOP.toLocaleString('es-CO', { minimumFractionDigits: 2 }) + ' COP';
                    actualizarValorRecibir();
                }
            });
    }

    function actualizarValorRecibir() {
        const cantidad = parseFloat(document.getElementById("cantidad").value) || 0;
        const token = document.getElementById("token").value;
        const precioCOP = preciosTokens[token] || 0;
        const valorRecibir = cantidad * precioCOP * (1 - 0.22); // Aplicar comisión del 0.19%
        document.getElementById("valor-recibir").textContent = valorRecibir.toLocaleString('es-CO', { minimumFractionDigits: 2 }) + ' COP';
    }

    function generarQRCode() {
        const urlBloque = document.getElementById("url-bloque").value;
        $('#qrcode').qrcode(urlBloque);
    }

    function enviarWhatsApp() {
        const nombre = document.getElementById("nombre").value;
        const documento = document.getElementById("documento").value;
        const cuenta = document.getElementById("cuenta").value;
        const wallet = document.getElementById("wallet").value;
        const token = document.getElementById("token").value;
        const cantidad = document.getElementById("cantidad").value;
        const precioToken = document.getElementById("precio-token").textContent;
        const valorRecibir = document.getElementById("valor-recibir").textContent;
        const urlBloque = document.getElementById("url-bloque").value;
        const idTransferencia = document.getElementById("id-transferencia").value;

        const mensaje = `Confirmación de Pago:\nNombre: ${nombre}\nDocumento: ${documento}\nCuenta: ${cuenta}\nWallet del Cliente: ${wallet}\nToken Seleccionado: ${token}\nCantidad: ${cantidad}\nPrecio del Token: ${precioToken}\nValor a Recibir: ${valorRecibir}\nURL del Bloque: ${urlBloque}\nIdentificador de Transferencia: ${idTransferencia}`;

        const urlWhatsApp = `https://wa.me/3248092374?text=${encodeURIComponent(mensaje)}`;
        window.open(urlWhatsApp, '_blank');
    }

    function generarIdentificadorTransferencia() {
        fetch('https://worldcoin.org/mini-app?app_id=app_2248679d8f07eb1b7eacd922f9a26a1e/api_a2V5XzEzZGI1NjI4ZDgz')
            .then(response => response.json())
            .then(data => {
                document.getElementById("id-transferencia").value = data.transferenciaId; // Asegúrate de que la respuesta tenga este campo
            })
            .catch(error => console.error('Error al obtener el identificador de transferencia:', error));
    }

    document.addEventListener("DOMContentLoaded", function() {
        ["WLD", "ORB", "ORO", "USDT", "ETH", "BTC"].forEach(obtenerPrecioToken);
        document.getElementById("cantidad").addEventListener("input", actualizarValorRecibir);
        document.getElementById("token").addEventListener("change", () => {
            obtenerPrecioToken(document.getElementById("token").value);
            actualizarValorRecibir();
        });
        generarIdentificadorTransferencia(); // Generar identificador al cargar la página
    });
</script>

<div id="qrcode" style="text-align: center;"></div>
</body>
</html>
